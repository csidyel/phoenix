version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2004
blocks:
  - name: npm test
    task:
      jobs:
        - name: npm test
          commands:
            - checkout
            - cache restore
            - sem-version node 12.22.12
            - cd assets
            - npm install
            - npm test
            - cache store
    dependencies: []
  - name: integration-test-elixir
    dependencies: []
    task:
      env_vars:
        - name: FORCE_COLOR
          value: '1'
      jobs:
        - name: integration-test-elixir
          commands:
            - checkout
            - sem-version elixir 1.14.0
            - sem-version erlang 24.3.4
            - 'sudo /bin/sh -c ''wget https://github.com/earthly/earthly/releases/download/v0.5.16/earthly-linux-amd64 -O /usr/local/bin/earthly && chmod +x /usr/local/bin/earthly'''
            - earthly -P --build-arg ELIXIR=1.14.0 --build-arg OTP=24.3.4 +integration-test
